<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>카테고리 하나 선택한 페이지</title>
    <link rel="stylesheet" type="text/css" href="./src/bootstrap/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="./src/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./dist/style.css">
</head>
<body>
<script id="storeListTemplate" type="text/template">
    <div class="col-xs-4">
        <a href="#" value="${storeId}">
            <div class="storeCard">
                <div class="storeCardLeft">
                    <img src=${storeImg}>
                </div>
                <div class="storeCardRight">
                    <div class="storeCardTitle">${storeName}</div>
                    <div class="storeCardStars">
                        <span class="storeCardGreyStar">
                            <span class="storeCardOrangeStar"></span>
                        </span>
                    </div>
                    <div class="storeCardAddress">
                        ${address}
                    </div>
                    <div class="storeCardReviewSection">
                        <span class="storeCardReviewKey">리뷰</span>
                        <span class="storeCardReviewValue">11</span>
                        <span class="storeCardReviewKey">사장님 댓글</span>
                        <span class="storeCardReviewValue">11</span>
                    </div>
                    <div class="storeCardLabel">
                        <span>바로결제</span>
                        <span>만나서결제</span>
                    </div>
                </div>
            </div>
        </a>
    </div>
</script>
<div class="row header m-x-0">
    <div class="float-right p-a-1 loginMenu">ygna91님 | 마이페이지 | 로그아웃 | 고객센터 | 즐겨찾기</div>
    <div class="baeminMainLogo"></div>

    <div class="searchArea">
        <div class="float-left p-r-1">
            <div class="locationSelect">
                송파구 방이동
            </div>
            <div class="locationSelectButton"></div>
        </div>
        <div class="float-left">
            <input class="searchBox" type="text">
            <div class="searchBoxButton"></div>
        </div>
    </div>

</div>
<div class="mobileTitleArea row">
    <div class="float-left mobileTitleButton"></div>
    <div class="mobileTitleImg"></div>
</div>

<div class="row blackMenuArea">
    <ul class="categoryWrapper">
        <li class="blackMenuChicken blackMenu" data="치킨"></li>
        <li class="blackMenuChinese blackMenu" data="중국집"></li>
        <li class="blackMenuPizza blackMenu" data="피자"></li>
        <li class="blackMenuKorean blackMenu" data="한식"></li>
        <li class="blackMenuPigfeet blackMenu" data="족발"></li>
        <li class="blackMenuNight blackMenu" data="야식"></li>
        <li class="blackMenuJapanese blackMenu" data="일식"></li>
        <li class="blackMenuSoup blackMenu" data="찜탕"></li>
        <li class="blackMenuVento blackMenu" data="도시락"></li>
        <li class="blackMenuFastfood blackMenu" data="패스트푸드"></li>
        <li class="blackMenuQuickpay blackMenu" data="바로결제"></li>
        <li class="blackMenuTogether blackMenu" data="모아보기"></li>
    </ul>
</div>

<div class="mobileCategory col-xs-12">
    <div class="mobileCategorySearch col-xs-12">
        <input type="text" placeholder="업소명을 검색해주세요">
    </div>
    <div class="mobileMenuWrap">
        <div class="col-xs-4 mobileMenu" data="치킨">치킨</div>
        <div class="col-xs-4 mobileMenu" data="중국집">중국집</div>
        <div class="col-xs-4 mobileMenu" data="피자">피자</div>
    </div>
    <div class="mobileMenuWrap">
        <div class="col-xs-4 mobileMenu" data="한식">한식,분식</div>
        <div class="col-xs-4 mobileMenu" data="족발">족발,보쌈</div>
        <div class="col-xs-4 mobileMenu" data="야식">야식</div>
    </div>
    <div class="mobileMenuWrap">
        <div class="col-xs-4 mobileMenu" data="일식">돈까스,회,일식</div>
        <div class="col-xs-4 mobileMenu" data="찜탕">찜,탕</div>
        <div class="col-xs-4 mobileMenu" data="도시락">도시락</div>
    </div>
    <div class="mobileMenuWrap">
        <div class="col-xs-4 mobileMenu" data="패스트푸드">패스트푸드</div>
        <div class="col-xs-4 mobileMenu" data="바로결제">바로결제</div>
        <div class="col-xs-4 mobileMenu" data="모아보기">모아보기</div>
    </div>
</div>

<div class="storeLayout row m-x-auto">
	  <div class="m-x-3 m-b-2">홈 >	피자|서울 송파구 잠실4동을 중심으로	총 71곳을 찾았습니다.</div>
    <div class="col-xs-12 storeCardRow">

    </div>
</div>

<div class="row footer"></div>

<script src="./dist/index.bundle.js"></script>
<script>

  class StoreList {

    constructor(cat){
      this.getStoreList(cat);
    }

    getStoreList(cat) {
      let xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          const response = JSON.parse(this.responseText);
          const renderTarget = document.querySelector(".storeCardRow");
          renderTarget.innerHTML = "";
          response.forEach(function (oneStore) {
            const store = oneStore;
            const storeId = store.storeId;
            const storeImg = store.storeImg;
            const storeName = store.storeName;
            const address = store.address;
            const tempGrab = document.querySelector("#storeListTemplate").text;
            const result = eval('`' + tempGrab + '`');
            renderTarget.innerHTML += result;
          })
        }
      };
      xhttp.open("GET", "http://13.124.179.176:3000/stores/bycategory/" + cat, true);
      xhttp.send();
    }

  }

  let clickedMenu = document.querySelector(".categoryWrapper");
  clickedMenu.addEventListener("click", function(e) {
    if (e.target.tagName !== "LI") {
      e.target = e.target.closest(".blackMenu");
    }
    let categoryList = new StoreList(e.target.attributes.data.value);
  });


  let clickedMobileMenu = document.querySelector(".mobileCategory");
  clickedMobileMenu.addEventListener("click", function(e) {
    if (e.target.className !== "col-xs-4 mobileMenu"){
      e.target = e.target.closest(".mobilekMenu");
    }
    let categoryList = new StoreList(e.target.attributes.data.value);
  });

</script>
</body>
</html>