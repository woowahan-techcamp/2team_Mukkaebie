<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>도넛 차트 테스트</title>
    <link rel="stylesheet" type="text/css" href="./src/main.css">
    <link rel="stylesheet" type="text/css" href="./src/chart.css">
</head>
<body>


<figure>
    <div class="figure-content">
        <svg width="80%" height="80%" viewBox="0 0 42 42" class="donut" aria-labelledby="menu-title menu-desc"
             role="img">
            <title id="menu-title">도넛 차트</title>
            <desc id="menu-desc">도넛 차트는 해당 업소의 주문량 기준 상위 3개 인기 메뉴를 보여준다.</desc>

            <circle class="donut-hole" cx="21" cy="21" r="15.91549430918954" fill="#f4ebdd" role="presentation"></circle>
            <circle class="donut-ring" cx="21" cy="21" r="15.91549430918954" fill="transparent" stroke="#d2d3d4" stroke-width="8" role="presentation"></circle>
            <!-- unused remain share -->

        </svg>
    </div>
    <figcaption class="figure-key">
        <p class="sr-only">도넛 차트는 해당 업소의 주문량 기준 상위 3개 인기 메뉴를 보여준다.</p>

        <ul class="figure-key-list" aria-hidden="true" role="presentation">
            <li class="label">
                <span class="shape-rect shape-1"></span>
            </li>
            <li class="label">
                <span class="shape-rect shape-2"></span>
            </li>
            <li class="label">
                <span class="shape-rect shape-3"></span>
            </li>
            <li class="label">
                <span class="shape-rect shape-4"></span>기타
            </li>
        </ul>
    </figcaption>
</figure>

<script type="text/javascript">

    var xhr = new XMLHttpRequest();

    xhr.onload = function() {
        if(xhr.status === 200) {
            let responseObject = JSON.parse(xhr.responseText);
            let circleContent = '';
            let colorArr = ['rgb(110,239,192)', 'rgb(42,193,188)', 'rgb(130,198,255)'];
            let share = 0;
            let reverse = 0;
            let offset = 25;
            let totalLength = 0;
            let label = document.querySelectorAll('.label');

            for (let i = 0; i < 3; i++) {
                share = responseObject.menu[i].orders;
                reverse = 100 - share;
                circleContent += '<circle class="donut-segment" cx="21" cy="21" r="15.91549430918954" fill="transparent" stroke="' + colorArr[i] + '" stroke-width="8" stroke-dasharray="'+ share + ' ' + reverse + '" stroke-dashoffset="' + offset +'">';
                circleContent += '<title class="donut-segment-title">' + responseObject.menu[i].title + '</title>';
                circleContent += '<desc class="donut-segment-desc">' + responseObject.menu[i].price + '원</desc>';
                circleContent += '</circle>';

                label[i].insertAdjacentHTML('beforeend', responseObject.menu[i].title);
                totalLength = totalLength + responseObject.menu[i].orders;
                offset = 100 - totalLength + 25;
            }

            let svg = document.querySelector('svg');
            svg.insertAdjacentHTML('beforeend', circleContent);

        }
    };

    xhr.open('GET', './menu.json', true);
    xhr.send(null);

</script>
</body>
</html>